{
  "$schema": "http://json-schema.org/draft-07/schema",
  "$ref": "#/definitions/Protocol",

  "definitions": {
    "Protocol": {
      "type": "object",
      "properties": {
        "protocolSchema": { "const": "v2" },
        "name": { "type": "string" },
        "description": { "type": "string" },
        "steps": {
          "type": "array",
          "items": { "$ref": "#/definitions/Step" },
          "minItems": 1
        },
        "config": {
          "type": "array",
          "items": { "$ref": "#/definitions/Config" }
        }
      },
      "required": ["protocolSchema", "name", "description", "steps"],
      "additionalProperties": false
    },

    "Step": {
      "type": "object",
      "properties": {
        "slug": { "$ref": "#/definitions/Slug" },
        "name": { "type": "string" },
        "description": { "type": "string" },
        "type": { "type": "string" },
        "script": { "$ref": "#/definitions/Script" },
        "functionSlug": { "type": "string" },
        "options": { "type": "object" }
      },
      "required": ["slug", "description", "type", "script", "functionSlug"],
      "additionalProperties": false
    },

    "Script": {
      "type": "object",
      "properties": {
        "namespace": { "type": "string" },
        "slug": { "type": "string" },
        "version": { "type": "string" },
        "runnerType": { "type": "string", "enum": ["ecs", "windows-script"] },
        "maxCount": { "type": "integer", "minimum": 0, "maximum": 50 },
        "memoryInMB": { "type": "integer", "minimum": 0, "maximum": 8192 }
      },
      "required": ["namespace", "slug", "version"],
      "additionalProperties": true
    },

    "Config": {
      "type": "object",
      "properties": {
        "slug": { "type": "string" },
        "name": { "type": "string" },
        "description": { "type": "string" },
        "type": { "type": "string" },
        "required": { "type": "boolean" },
        "step": { "type": "string" }
      },
      "required": ["slug", "name", "description", "type", "required", "step"],
      "additionalProperties": false
    },

    "Slug": {
      "type": "string",
      "pattern": "^[a-zA-Z][-a-zA-Z0-9]*$"
    }
  }
}
